<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Democracy & Governance Values Survey</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
    #plots { display: flex; justify-content: space-around; flex-wrap: wrap; }
    .plot-container { width: 45%; min-width: 400px; }
    button { padding: 10px 20px; margin-top: 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>Values in Democracy & Governance</h2>
  <p>Please click once on each plot: one for <b>Today</b>, and one for the <b>Year 2075</b>.</p>

  <div id="plots">
    <div class="plot-container">
      <h3>Present Day</h3>
      <div id="plotPresent"></div>
    </div>
    <div class="plot-container">
      <h3>2075</h3>
      <div id="plotFuture"></div>
    </div>
  </div>

  <button onclick="submitData()">Submit Responses</button>

  <script>
    let presentValues = null;
    let futureValues = null;

    function createPlot(divId, callback) {
      let data = [{
        type: 'scatterternary',
        mode: 'markers',
        a: [], b: [], c: [],
        marker: { size: 10, color: 'blue' }
      }];

      let layout = {
        ternary: {
          sum: 100,
          aaxis: { title: 'Equality', min: 0, linewidth: 2 },
          baxis: { title: 'Security', min: 0, linewidth: 2 },
          caxis: { title: 'Efficiency', min: 0, linewidth: 2 }
        },
        margin: { t: 30, l: 30, r: 30, b: 30 }
      };

      Plotly.newPlot(divId, data, layout);

      document.getElementById(divId).on('plotly_click', function(event) {
        let point = event.points[0];
        let values = { Equality: point.a, Security: point.b, Efficiency: point.c };

        Plotly.update(divId, { a: [point.a], b: [point.b], c: [point.c] });

        callback(values);
      });
    }

    createPlot("plotPresent", function(v) { presentValues = v; });
    createPlot("plotFuture", function(v) { futureValues = v; });

    function submitData() {
      if (!presentValues || !futureValues) {
        alert("Please click on both plots first.");
        return;
      }

      let payload = {
        timestamp: new Date().toISOString(),
        present: presentValues,
        future: futureValues
      };

      // Google Apps Script Web App URL
      let url = "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE";

      fetch(url, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      alert("Thank you! Your response has been submitted.");
    }
  </script>
</body>
</html>
