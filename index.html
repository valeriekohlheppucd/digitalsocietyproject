<!DOCTYPE html>
<html>
  <head>
    <title>CivicTrust Values Survey</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <h2>Balance of Governance Values</h2>
    <p>Please click inside each triangle to show how you think society balances Equality, Security, and Efficiency.</p>

    <!-- Plot for Present -->
    <div id="plot-present" style="width:600px;height:600px;"></div>

    <!-- Plot for Future (2075) -->
    <div id="plot-future" style="width:600px;height:600px;"></div>

    <!-- Submit button -->
    <button onclick="submitResponse()">Submit</button>

    <script>
      let presentValues = null;
      let futureValues = null;

      // Create empty ternary plots
      function createPlot(divId, label, callback) {
        Plotly.newPlot(divId, [{
          type: 'scatterternary',
          mode: 'markers',
          a: [], b: [], c: []
        }], {
          ternary: {
            aaxis: {title: 'Equality', min: 0, tickangle: 0},
            baxis: {title: 'Security', min: 0},
            caxis: {title: 'Efficiency', min: 0}
          },
          title: label
        });

        document.getElementById(divId).on('plotly_click', function(data) {
          const point = data.points[0];
          if (divId === "plot-present") {
            presentValues = {Equality: point.a, Security: point.b, Efficiency: point.c};
          } else {
            futureValues = {Equality: point.a, Security: point.b, Efficiency: point.c};
          }
        });
      }

      createPlot("plot-present", "Today (2025)", "present");
      createPlot("plot-future", "Future (2075)", "future");

      function submitResponse() {
        if (!presentValues || !futureValues) {
          alert("Please click on both plots before submitting!");
          return;
        }

        const payload = {
          "Present Equality": presentValues.Equality,
          "Present Security": presentValues.Security,
          "Present Efficiency": presentValues.Efficiency,
          "Future Equality": futureValues.Equality,
          "Future Security": futureValues.Security,
          "Future Efficiency": futureValues.Efficiency
        };

        fetch("https://script.google.com/a/macros/ucdconnect.ie/s/AKfycbwiTv-MFMkyBh5_7tYwrMtSpM7YAeo1xQMrgDz_q6aUmcExxiXQ7g48y8TPZD67_ILQuw/exec", {
          method: "POST",
          body: JSON.stringify(payload),
          headers: { "Content-Type": "application/json" }
        }).then(res => alert("Response submitted!"))
          .catch(err => alert("Error submitting response"));
      }
    </script>
  </body>
</html>
